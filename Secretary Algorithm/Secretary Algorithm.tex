\documentclass{article}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{pifont}
\usepackage{amsmath}
\usepackage{amsfonts}

%\DeclareMathOperator{\prob}{P}

\newcommand{\prob}{\mathbb{P}}
\newcommand{\expec}{\mathbb{E}}

\begin{document}

%$i \approx j$ means that $i$ and $j$ are in-distinguishable in the first observation.
%    
%    
%    \begin{itemize}
%  \item (reflexivity) $i \approx i$
%   \item(symmetry) $i \approx j \iff j \approx i$
%   \item(connectedness) $i \approx j , r_i < r_j \implies \forall k, l [r_k, r_l \in [r_i, r_j] \implies r_k \approx r_l ]$
%\end{itemize}
%




\begin{algorithm}
\caption{Oct 14 2021}
\label{algo1} 
\begin{algorithmic}[1]

\For{$i \in [n]$}
	\State{$\alpha \gets$ the current item to be decided}
	\If{$i < \lfloor \frac{n}{e}\rfloor$} \Comment Phase 1
		\If{$\exists \beta\in O_i \ldotp \alpha <_i \beta$}\Comment $\alpha$ is \emph{not} a maximum
			\State{Decline this item}
		\ElsIf{$\alpha \in E_i$}
			\State{Decline this item}
		\Else 
			\State{Examine this item}
		\EndIf
			
	\ElsIf{$i < n$}\Comment Phase 2
		\If{$\exists \beta\in O_i \ldotp \alpha <_i \beta$}
			\State{Decline this item}
		\Else				\If{$\forall \beta\in O_i \ldotp \beta \leq_i \alpha$} \Comment $\alpha$ is the absolute maximum
				\State{Accept this item}
			\ElsIf{$\alpha \in E_i$}
				\State{Decline this item}
			\Else
				\State{Examine this item}
			\EndIf
		\EndIf
	\Else
		\State{Accept this item}
	\EndIf

\EndFor

\end{algorithmic}
\end{algorithm}




\begin{algorithm}
\caption{Game Process}
\label{algo1} 
\begin{algorithmic}[1]


\State{$[n], r_i$ and $\approx$ relation are given according to definition}


\State{$O_1 = \{1\}$}
\State{$E_1 = \emptyset$}
\State{$\alpha_1 = 1$}
\State{$\Theta_1 = \emptyset$}



\For{$i \in [n]$}
	\State{$d_{i} \gets $ player's decision}
	\If{$d_i = \mathrm{Accept}$}
		\If{$\alpha_i = \mathrm{argmax}_j r_j$}
			\State Game terminates and player wins
		\Else
			\State Game terminates and player loses
			\EndIf
			
	\ElsIf{$d_i = \mathrm{Decline}$}
		\State{$O_{i+1} \gets O_i\cup \{i+1\}$}
		\State{$E_{i+1} \gets E_i$}
		\State{$\alpha_{i+1} \gets i+1$}
		
	\ElsIf{$d_i = \mathrm{Examine}$}
		\State{$O_{i+1} \gets O_i$}
		\State{$E_{i+1} \gets E_i\cup \{i\}$}
		\State{$\alpha_{i+1} \gets \alpha$}
	\EndIf
	\State{$\Theta_{i+1} \gets 
		\{(\beta, \gamma) \in O_{i+1}^2: r_\beta < r_\gamma, \beta \not\approx \gamma\} \cup
		\{(\beta, \gamma) \in E_{i+1}^2: r_\beta < r_\gamma\}$}
	
	
\EndFor

\end{algorithmic}
\end{algorithm}

\pagebreak

$\alpha_i$ denotes the item that arrives at the $i$-th round

$q(i) := \prob[\mathrm{examines}\, \alpha_i]$

$F(i) := \expec[|O_i|]$

\begin{equation*}
	\prob[\text{accepts } i] = 
	\prob[\alpha_i = i] 
	\prob[\text{accepts }\alpha_i | \alpha_i = i]
	+ 
	\prob[\alpha_{i+1} = i]
	\prob[\text{accepts }\alpha_{i+1} | \alpha_{i+1} = i]
\end{equation*}

\begin{equation*}
	\prob[\text{win}] = \sum_{i=\lfloor\frac{n}{e}\rfloor+1}^n
	\prob[\text{accepts } i]\prob[i\text{ is best}]
\end{equation*}


$\alpha_i = i$ iff the player does not examine $\alpha_{i-1}$. Hence
\begin{align*}
\prob[\alpha_i = i] &= 1-q(i-1) \\
\prob[\alpha_{i+1} = i] &= q(i) 
\end{align*}

\begin{gather*}
p(i):= \prob[\text{No accept until }\alpha_{i}] = \prod_{j=\lfloor\frac{n}{e}\rfloor + 1}^{i} \left( 1-\frac{1}{|N_{\alpha_j}| - 1} \right) \\
\prob[\text{accepts }\alpha_i | \alpha_i = i] = \prob[\alpha_i >_i O_i]\cdot p(i-1) \\
\prob[\alpha_i >_i O_i] = \prob[\alpha_i >_i O_i | \alpha_i >_r O_i] \prob[\alpha_i >_r O_i] = \frac{\binom{|O_i|-1}{|N_i|-1}}{\binom{n-1}{|N_i|-1}} \frac{1}{|O_i|} \\
\prob[\text{accepts }\alpha_{i+1} | \alpha_{i+1} = i] = \prob[\text{examines } \alpha_i] \prob[\alpha_i >_{i+1} O_i | \text{examines } \alpha_i] \cdot  p(i-1) = q(i) \frac{1}{|N_{\alpha_i}|} p(i-1)
\end{gather*} 

$q(i)$ and $F(i)$ can be solved iteratively using the following:

\begin{gather*}
q(i)= \begin{cases}
\left(\frac{1}{|O_{i-1}|+1} + \frac{|N_{\alpha_i}|-m(i)}{n-i+1}\right)(1-q(i-1)) &i\leq\lfloor\frac{n}{e}\rfloor \\
\frac{|N_{\alpha_i}|-m(i)}{n-i+1}(1-q(i-1)) &i>\lfloor\frac{n}{e}\rfloor
\end{cases} \\
m(i) = |N_{\alpha_i}|\frac{|O_i|-1}{n} \\
F(i) := f(1,i)\\
f(j,i) := 1+q(j)f(j+2,i) + (1-q(j))f(j+1,i)\\
f(i,i) := 1\\
f(i+1,i) := 0
\end{gather*}


\end{document} 