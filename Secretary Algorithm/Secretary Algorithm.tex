\documentclass{article}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{pifont}
\usepackage{amsmath}
\usepackage{amsfonts}

%\DeclareMathOperator{\prob}{P}

\newcommand{\prob}{\mathbb{P}}
\newcommand{\expec}{\mathbb{E}}
\newcommand{\gt}{>}
\newcommand{\lt}{<}

\begin{document}

%$i \approx j$ means that $i$ and $j$ are in-distinguishable in the first observation.
%    
%    
%    \begin{itemize}
%  \item (reflexivity) $i \approx i$
%   \item(symmetry) $i \approx j \iff j \approx i$
%   \item(connectedness) $i \approx j , r_i < r_j \implies \forall k, l [r_k, r_l \in [r_i, r_j] \implies r_k \approx r_l ]$
%\end{itemize}
%




\begin{algorithm}
\caption{Oct 14 2021}
\label{algo1} 
\begin{algorithmic}[1]

\For{$i \in [n]$}
	\State{$\alpha \gets$ the current item to be decided}
	\If{$i < \lfloor \frac{n}{e}\rfloor$} \Comment Phase 1
		\If{$\exists \beta\in O_i \ldotp \alpha <_i \beta$}\Comment $\alpha$ is \emph{not} a maximum
			\State{Decline this item}
		\ElsIf{$\alpha \in E_i$}
			\State{Decline this item}
		\Else 
			\State{Examine this item}
		\EndIf
			
	\ElsIf{$i < n$}\Comment Phase 2
		\If{$\exists \beta\in O_i \ldotp \alpha <_i \beta$}
			\State{Decline this item}
		\Else				\If{$\forall \beta\in O_i \ldotp \beta \leq_i \alpha$} \Comment $\alpha$ is the absolute maximum
				\State{Accept this item}
			\ElsIf{$\alpha \in E_i$}
				\State{Decline this item}
			\Else
				\State{Examine this item}
			\EndIf
		\EndIf
	\Else
		\State{Accept this item}
	\EndIf

\EndFor

\end{algorithmic}
\end{algorithm}




\begin{algorithm}
\caption{Game Process}
\label{algo1} 
\begin{algorithmic}[1]


\State{$[n], r_i$ and $\approx$ relation are given according to definition}


\State{$O_1 = \{1\}$}
\State{$E_1 = \emptyset$}
\State{$\alpha_1 = 1$}
\State{$\Theta_1 = \emptyset$}



\For{$i \in [n]$}
	\State{$d_{i} \gets $ player's decision}
	\If{$d_i = \mathrm{Accept}$}
		\If{$\alpha_i = \mathrm{argmax}_j r_j$}
			\State Game terminates and player wins
		\Else
			\State Game terminates and player loses
			\EndIf
			
	\ElsIf{$d_i = \mathrm{Decline}$}
		\State{$O_{i+1} \gets O_i\cup \{i+1\}$}
		\State{$E_{i+1} \gets E_i$}
		\State{$\alpha_{i+1} \gets i+1$}
		
	\ElsIf{$d_i = \mathrm{Examine}$}
		\State{$O_{i+1} \gets O_i$}
		\State{$E_{i+1} \gets E_i\cup \{i\}$}
		\State{$\alpha_{i+1} \gets \alpha$}
	\EndIf
	\State{$\Theta_{i+1} \gets 
		\{(\beta, \gamma) \in O_{i+1}^2: r_\beta < r_\gamma, \beta \not\approx \gamma\} \cup
		\{(\beta, \gamma) \in E_{i+1}^2: r_\beta < r_\gamma\}$}
	
	
\EndFor

\end{algorithmic}
\end{algorithm}

\pagebreak

$\alpha_i$ denotes the item that arrives at the $i$-th round

$q(i) := \prob[\text{examines} \alpha_i | \text{ reaches }i]$

$F(i) := \expec[|O_i|]$

$p(i):= \prob[\text{reaches }i]$

$p(i|j):= \prob[\text{reaches }i | \text{reaches }j]$

$s(i) := \prob[\alpha_i \gt_i O_i]$ 

$w(i) := \prob[\alpha_i \gt_r N_{\alpha_i}]$


\begin{align*}
s(j) &= \prob[\alpha_j \gt_j O_j]\\
&= \prob[N_{\alpha_j}^\circ \subset O_j^c]\prob[\alpha_j \gt_r O_j] \\
&= \frac{\binom{n-|O_j|}{|N_{\alpha_j}|-1}}{ \binom{n-1}{|N_{\alpha_j}|-1}} \frac{1}{|O_j|}
\end{align*}

\begin{align*}
w(j) &= \prob[\alpha_i \gt_r N_{\alpha_i}]\\
&= \frac{1}{|N_{\alpha_j}|}
\end{align*}


\begin{align*}
p(i) &= \prob[\text{no accept until }\alpha_{i-1}]=\prod_{j=\lfloor\frac{n}{e}\rfloor + 1}^{i-1} \left( p(j|j-1) \right)\\
p(i|i-1) &= \prob[\text{decline }\alpha_{i-1}]\prob[\alpha_i \not >_i O_i | \text{decline }\alpha_{i-1}] + \prob[\text{examine }\alpha_{i-1}]\prob[\alpha_{i} \not >_i N_{\alpha_i} | \text{examine }\alpha_{i-1}]\\
&= \left( 1-q(i-1) \right)(1-s(i)) + q(i-1)(1-w(i))\\
\end{align*}





\begin{align*}
	&\prob[\text{accepts } i | \text{reaches }i] \\&= 
	\prob[\alpha_i = i | \text{reaches }i] 
	\prob[\text{accepts }\alpha_i | \alpha_i = i, \text{reaches }i]
	\\&+
	\prob[\alpha_{i+1} = i | \text{reaches }i]
	\prob[\text{accepts }\alpha_{i+1} | \alpha_{i+1} = i, \text{reaches }i]\\
	&= (1-q(i))s(i) + q(i) w(i)
\end{align*}

\begin{equation*}
\prob[i \text{ is best}|\text{accept }i] = \frac{|O_i|}{n}
\end{equation*}

\begin{equation*}
	\prob[\text{win}] = \sum_{i=\lfloor\frac{n}{e}\rfloor+1}^n
	\prob[\text{accepts } i ]\prob[i\text{ is best} | \text{accepts } i ]
\end{equation*}



\begin{align*}
q(i) &= \prob[\text{examine }\alpha_i]\\
&= \prob[\text{decline }\alpha_{i-1}]\left(\prob[O_i <_i \alpha_i |\text{decline }\alpha_{i-1}]+\prob[\alpha_i \in N_{\max_i O_i}|\text{decline }\alpha_{i-1}]\right)\\
&\prob[O_i <_i \alpha_i |\text{decline }\alpha_{i-1}] = \prob[O_i <_i \alpha_i] = \frac{1}{|O_i|}\\
&\prob[\alpha_i \in N_{\max_i O_i}|\text{decline }\alpha_{i}] = \prob[\alpha_{i-1} \in N_{\max_{i-1} O_{i-1}}\setminus O_{i-1}] = \frac{|N|-m(i-1)}{n-i+1}
\end{align*}
where we let $m(i):=|N_i\cap O_i|$.

\begin{equation*}
\expec[m(i)] = |N_i|\frac{|O_i|}{n}
\end{equation*}

$q(i)$ and $F(i)$ can be solved iteratively using the following:

\begin{gather*}
q(i)= \begin{cases}
\left(\frac{1}{|O_{i-1}|+1} + \frac{|N_{\alpha_i}|-m(i)}{n-i+1}\right)(1-q(i-1)) &i\leq\lfloor\frac{n}{e}\rfloor \\
\frac{|N_{\alpha_i}|-m(i)}{n-i+1}(1-q(i-1)) &i>\lfloor\frac{n}{e}\rfloor
\end{cases} \\
m(i) = |N_{\alpha_i}|\frac{|O_i|-1}{n} \\
F(i) := f(1,i)\\
f(j,i) := 1+q(j)f(j+2,i) + (1-q(j))f(j+1,i)\\
f(i,i) := 1\\
f(i+1,i) := 0
\end{gather*}

\newpage

\newcommand{\ALG}{\text{ALG}}

Assume $i > \lfloor n/e \rfloor $. We first observe that $O_i$ is a uniformly random sample from $[n]$. Therefore, the apparent rank of any upcoming item $\alpha_i$ is uniformly distributed in $[k]$, where $k = |O_i|$.

In particular, $\alpha_i >_r \sup O_i$ with probability $1/k$. This is the necessary and sufficient condition for $\alpha_i$ to be accepted (A) by $\ALG$.

Define $N_j := \{k\in[n] | k \approx j\}$ be the neighbour of item $j$.

Given $\alpha_i$ is finally declined (ED/D), it is examined and declined (ED) by $\ALG$ iff $\alpha_i \in N_{\sup O_{i-1}}$, and declined directly (D) iff $\alpha_i \not \in  N_{\sup O_{i-1}}$. Let $M_i = O_{i-1}\cap N_{\sup O_{i-1}}$ be the observed neighbor of so-far best item. By analyzing relative ranks, the probability of ED taken over all permutations $\Theta_r$ is bounded by

\begin{equation}\label{ED given D bound}
\frac{|M_{i-1}|-1}{|O_{i-1}|} \leq
\prob[ED(i) | ED \cup D(i), |O_i|, |M_i|] \leq
\frac{|M_{i-1}|}{|O_{i-1}|}
\end{equation}

In case of D, $O_{i+1} = O_i + \{\alpha_i\}$ and the process continues for next $i$. ED forgoes one item un-observed. Hence $O_{i+2} = O_i + \{\alpha_i\}$ and the process continues for $i+2$.

Let $G(m)$ denote the probability that $\ALG$ accepts any item before round $m$. Given a particular arrival order $\Theta_r$, the game state can be expressed by $(i,s)$ where $i$ is the current round and $s = |O_i|$. It can be solved by iterated equation:

\begin{gather*}
G(m) = g(1, 1)\\
g(i,s) = \begin{cases}
\mathbf{1}(A|\mathcal{H}_{is}) + 
\mathbf{1}(ED|\mathcal{H}_{is})g(i+2, s+1) + 
\mathbf{1}(D|\mathcal{H}_{is})g(i+1,s+1) & \lfloor n/e \rfloor<i<n\\
[\mathbf{1}(A|\mathcal{H}_{is}) + 
\mathbf{1}(ED|\mathcal{H}_{is})]g(i+2, s+1) + 
\mathbf{1}(D|\mathcal{H}_{is})g(i+1,s+1) & i\leq\lfloor n/e \rfloor\\
0 & i \geq n
\end{cases}
\end{gather*}

$\mathcal{H}_{is}$ denotes all information for the game state, including $(i,s)$ and the total order $\Theta_r$.
Take expectation over $\Theta_r$, and we obtain

\begin{equation*}
g(i,s) = \begin{cases}
1/s + 
p_{is}g(i+2, s+1) + 
(1-1/s-p_{is})g(i+1,s+1) & \lfloor n/e \rfloor<i<n\\
[1/s + 
p_{is}]g(i+2, s+1) + 
(1-1/s-p_{is})g(i+1,s+1) & i\leq\lfloor n/e \rfloor\\
0 & i \geq n
\end{cases}
\end{equation*}

where $p_{is} = \expec[\mathbf{1}(ED|\mathcal{H}_{is})]$, expectation taken over $\Theta_r$. We now give an upper bound to $p_{is}$. The upper bound will imply a lower bound to $\expec[\ALG]$, since ED induces more cost than D.

\begin{equation*}
p_{is} \leq \expec\left[\frac{|M_{i-1}|}{|O_{i-1}| }| i,s\right] \leq \epsilon/s
\end{equation*}

The first inequality follows from condition for ED, and second inequality follows from the assumption that $\alpha \approx \beta \iff |r_\alpha - r_\beta|\leq \epsilon$.

Now we use the identity

\begin{equation*}
\expec[\ALG] = \sum_{i=\lfloor n/e \rfloor}^n \frac{1}{n} (1-G(i))
\end{equation*}



\end{document} 